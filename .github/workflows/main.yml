name: Auto Merge

on:
  push:
    branches:
      - revision

jobs:
  check-and-merge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check parameter in index file
        run: |
          PARAM=$(grep "const versione = *.*.*" index.html || echo "false")
          echo "Parameter found: $PARAM"
          if [ -n "$PARAM" ]; then
            echo "Merging branch revision"
            git config --global user.name "MaZap75"
            git config --global user.email "mzappulla75@gmail.com"
            git fetch
            git checkout main
            echo "checkout main ok"
            git merge revision
          
          else
            echo "Merge condition not met."
          fi
